<div class="container">

  <% if current_user %>
    <div class="user-info">
      <div>
      <% if @user.photo.key %>
        <%= cl_image_tag @user.photo.key, class: 'user-img'%>
      <% else %>
        <img class="user-img" src="https://st3.depositphotos.com/6672868/13701/v/600/depositphotos_137014128-stock-illustration-user-profile-icon.jpg" alt="">
      <% end %>
      </div>
      <div>
        <h2 class="site-navigation-title">Welcome!ðŸ‘‹<br>
        <span><%= @user.first_name %></span></h2>
      </div>
    </div>
  <% end %>

  <div data-controller="search-products">
      <div class="search">
        <%= form_with url: products_path, method: :get, id: 'searchForm', class: "search-form", data: { search_products_target: "form", action: "keydown->search-products#update"} do %>
          <div class="search-bar">
            <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Search" %>
            <%= submit_tag "Search", class: "button submit-button" %>
          </div>

          <div class="search-filter">
            <% Product::CATEGORIES.each do |category|%>
              <div class="button secondary filter-search-button">
                <%= label_tag category %>
                <%= check_box_tag 'categories[]', category, false,
                data: {
                  search_products_target: "input",
                  action: "click->search-products#update"
                } %>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>

      <div class="products row">
        <% @products.each do |product| %>
          <%= content_tag :div, class: "col-6", id: "dom_id(product)" do %> <!-- Sebi tried to get anchors working -->
            <%= link_to product_path(product) do %>
              <div class="product-card">
                <% if product.photos.attached? %>
                  <% product.photos.each do |photo| %>
                    <%= cl_image_tag photo.key, class: 'product-img' %>
                  <% end %>
                <% else %>
                  <img class="product-show-img" src="https://www.kurin.com/wp-content/uploads/placeholder-square.jpg" alt="">
                <% end %>
                <div class="product-information">
                  <h2 class="product-title"><%= product.title %></h2>
                  <p class="product-price"><%= product.price %> â‚¬</p>
                </div>
                <% if user_signed_in? %>
                  <div class="favorite-button">
                    <% if Favorite.where(product_id: product.id, user_id: current_user.id).empty? %>
                      <%= link_to product_favorites_path(product), data: {turbo_method: :post} do %>
                        <i class="fa-regular fa-heart"></i>
                      <% end %>
                    <% else %>
                      <i class="fa fa-heart"></i>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
  </div>

</div>


<script>

checkboxes = document.querySelectorAll('.filter-search-button input')

checkboxes.forEach(checkbox => {
  checkbox.addEventListener('click', (event) => {
    event.currentTarget.parentElement.classList.toggle('secondary')
})
})

</script>
